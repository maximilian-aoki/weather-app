(()=>{"use strict";const t={};function e(e,o){t[e]=t[e]||[],t[e].push(o)}function o(e,o){t[e]&&t[e].forEach((t=>{t(o)}))}const n="f59714b9ced048d6b83171709230312";class c{static async getLocationData(t){const e=new URLSearchParams({key:n,days:2,q:t}),o=new Request("http://api.weatherapi.com/v1/forecast.json?"+e,{mode:"cors"});try{const t=await fetch(o),e=await t.json();return c.#t(e)}catch(t){return`Error in getLocationData: ${t}`}}static#t(t){const e={};return e.name=`${t.location.name}, ${t.location.country}`,e.isDay=Boolean(t.current.is_day),e.currentTimeIndex=Number(t.location.localtime.split(":")[0].split(" ")[1]),e.currentCondition=t.current.condition.text,e.currentConditionIcon=t.current.condition.icon,e.currentTempC=Math.round(t.current.temp_c),e.currentTempF=Math.round(t.current.temp_f),e.hours=c.#e(t,e.currentTimeIndex),e}static#e(t,e){return[...t.forecast.forecastday[0].hour.slice(e),...t.forecast.forecastday[1].hour.slice(0,e)].map((t=>{const e={};return e.timeIndex=Number(t.time.split(":")[0].split(" ")[1]),e.isDay=Boolean(t.is_day),e.condition=t.condition.text,e.conditionIcon=t.condition.icon,e.tempC=Math.round(t.temp_c),e.tempF=Math.round(t.temp_f),e}))}static async getLocationOptions(t){const e=new URLSearchParams({key:n,q:t}),o=new Request("http://api.weatherapi.com/v1/search.json?"+e,{mode:"cors"});try{const t=await fetch(o),e=await t.json();return c.#o(e)}catch(t){return`Error in getLocationOptions: ${t}`}}static#o(t){return[...new Set(t.map((t=>`${t.name}, ${t.country}`)))]}}const a=document.querySelector(".search-input"),i=document.querySelector(".search-results");class r{static async renderLocationNames(){if(a.value.length>=3){const t=await c.getLocationOptions(a.value);[...i.children].forEach((t=>i.removeChild(t))),t.forEach(r.#n)}else[...i.children].forEach((t=>i.removeChild(t)))}static#n(t){const e=document.createElement("li");e.classList.add("location"),e.innerText=t,i.appendChild(e)}static selectLocation(t){t.target.classList.contains("location")?(o("addLocation",t.target.innerText),a.value="",r.renderLocationNames()):"Enter"===t.key&&i.firstElementChild&&(o("addLocation",i.firstElementChild.innerText),a.value="",r.renderLocationNames())}}a.addEventListener("input",r.renderLocationNames),a.addEventListener("keypress",r.selectLocation),i.addEventListener("click",r.selectLocation);const s=document.querySelector(".locations-list");class l{static renderLocationList(t){[...s.children].forEach((t=>s.removeChild(t))),t.locations.forEach(l.#n)}static#n(t,e){const o=document.createElement("li");o.classList.add("location"),o.setAttribute("data-index",e),o.innerText=t.name,s.appendChild(o)}static changeLocation(t){console.log(Number(t.target.getAttribute("data-index")))}}s.addEventListener("click",l.changeLocation),e("renderLocationList",l.renderLocationList);class d{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.locations=t,this.currentLocIndex=e}addLocation(t){this.locations.push(t)}removeLocation(t){this.locations.splice(t,1)}refreshLocations(t){this.locations=t}getUserTime(){const t=new Date;this.userTime=t.toISOString().split(":")[0]}}let u;if(localStorage.getItem("user")){console.log("getting user from localStorage with time");const t=JSON.parse(localStorage.getItem("user")),e=localStorage.getItem("time");u=new d(t.locations,t.currentLocIndex);const n=(new Date).toISOString().split(":")[0];if(console.log(`time now: ${n}\nlast user time: ${e}`),n===e&&u.locations.length)try{L()}catch(t){console.log(`error on refresh: ${t}`)}o("renderLocationList",u)}else console.log("creating new user"),u=new d,console.log(u);function m(){u.getUserTime(),localStorage.setItem("time",u.userTime),localStorage.setItem("user",JSON.stringify(u))}async function L(){console.log("starting refresh");const t=u.locations.map((t=>c.getLocationData(t.name)));u.locations=await Promise.all(t),m(),console.log("finished refresh"),console.log(u)}e("addLocation",(async function(t){const e=await c.getLocationData(t);u.addLocation(e),u.currentLocIndex=u.locations.length-1,m(),o("renderLocationList",u),console.log("adding location"),console.log(u)})),e("removeLocation",(function(t){u.removeLocation(t),u.currentLocIndex=t<=u.currentLocIndex?u.currentLocIndex-=1:u.currentLocIndex,m(),console.log("removing location"),console.log(u)})),e("refreshLocations",L)})();
//# sourceMappingURL=app.bundle.js.map